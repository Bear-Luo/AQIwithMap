const cardComponent={template:'\n  <div class="box">\n    <div class="box-item" :class="statusClass">\n      <div>\n        {{ cardItem.County }} - {{ cardItem.SiteName }}\n        <a href="#" @click.prevent="cardFun"><slot name="i"><i class="far fa-star"></i></slot></a>\n      </div>\n      <div>\n        <ul class="list-unstyled">\n          <li>AQI 指數: {{ cardItem.AQI }}</li>\n          <li>PM2.5: {{ cardItem[\'PM2.5\' ]}}</li>\n          <li>說明: {{ cardItem.Status }}</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  ',props:["cardItem"],data:()=>({statusClass:{"status-aqi2":!1,"status-aqi3":!1,"status-aqi4":!1,"status-aqi5":!1,"status-aqi6":!1}}),created(){this.cardColor()},methods:{cardFun(){this.$emit("itemname")},cardColor(){switch(this.cardItem.Status){case"普通":this.statusClass["status-aqi2"]=!0;break;case"對敏感族群不健康":this.statusClass["status-aqi3"]=!0;break;case"對所有族群不健康":this.statusClass["status-aqi4"]=!0;break;case"非常不健康":this.statusClass["status-aqi5"]=!0;break;case"危害":this.statusClass["status-aqi6"]=!0}}}};var app=new Vue({el:"#app",data:{data:[],location:[],stared:[],filter:"all",countyName:"",isLoading:!1,isError:{status:!1,msg:"暫時無法更新"}},components:{card:cardComponent},created(){this.getData()},methods:{async getTaiwanMap(){const t=this.$refs.map.offsetWidth.toFixed(),e=this.$refs.map.offsetHeight.toFixed();let a,s=window.screen.width;if(s>1023){a=9e3;var i=await d3.geo.path().projection(d3.geo.mercator().center([121,24]).scale(a).translate([t/1.5,e/1.9])),r=await d3.select("#svg").attr("width",t).attr("height",e).attr("viewBox",`0 0 ${t} ${e}`),n="json/taiwan.geojson";return await d3.json(n,(t,e)=>{if(t)throw t;r.selectAll("path").data(e.features).enter().append("path").attr("d",i).attr({id:t=>"city"+t.properties.COUNTYCODE,name:t=>t.properties.COUNTYNAME}).on("click",t=>{document.querySelector(".active")&&document.querySelector(".active").classList.remove("active"),document.getElementById("city"+t.properties.COUNTYCODE).classList.add("active"),console.log(document.getElementById("city"+t.properties.COUNTYCODE));const e=this;e.filter=t.properties.COUNTYNAME})}),r}},getData(){const t=this;t.isLoading=!0;const e="https://cors-anywhere.herokuapp.com/http://opendata2.epa.gov.tw/AQI.json";fetch(e).then(function(t){if(t.ok)return t.json();throw new Error(!0)}).then(function(e){t.data=e;const a=t.data.map(t=>t.County);t.location=a.filter(function(t,e,a){return a.indexOf(t)===e}),t.isLoading=!1}).catch(function(e){t.isError.status=e,t.isLoading=!1}),t.stared=JSON.parse(localStorage.getItem("starStr"))||[]},updateStared(){localStorage.setItem("starStr",JSON.stringify(this.stared)),this.stared=JSON.parse(localStorage.getItem("starStr"))},addStar(t){this.stared.push(t),this.updateStared()},removeStar(t){this.stared.splice(this.stared.indexOf(t),1),this.updateStared()},areaAddActive(){if("all"===this.filter)document.querySelector(".active")&&document.querySelector(".active").classList.remove("active");else{document.querySelector(".active")&&document.querySelector(".active").classList.remove("active");const t=document.getElementsByName(this.filter)[0].id;document.getElementById(t).classList.add("active")}}},computed:{computedData(){const t=this;if("all"===this.filter)return t.data.filter(e=>-1==t.stared.indexOf(e.SiteId));{const e=t.data.filter(e=>-1==t.stared.indexOf(e.SiteId));return e.filter(t=>-1==e.indexOf(t.County))}},newStared(){const t=this;return t.data.filter(e=>t.stared.indexOf(e.SiteId)>=0)}},mounted(){this.getTaiwanMap()}});